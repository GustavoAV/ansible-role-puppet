---
- name: Include specific OS tasks
  ansible.builtin.include_tasks:
    file: setup-{{ ansible_os_family }}.yml
  when: ansible_os_family == 'Debian' or ansible_os_family == 'RedHat'

- name: Install Puppet.
  ansible.builtin.package:
    name: "{{ puppet_package }}"
    state: present

- name: Add Puppet bin directory to $PATH.
  ansible.builtin.lineinfile:
    dest: /etc/environment
    state: present
    backrefs: true
    regexp: 'PATH=(["]*)((?!.*?{{ puppet_bin_path }}).*?)(["]*)$'
    line: 'PATH=\1\2:{{ puppet_bin_path }}\3'
    mode: "0644"

- name: Ensure Puppet service is started and enabled at boot.
  ansible.builtin.service:
    name: "{{ puppet_service }}"
    state: "{{ puppet_service_state }}"
    enabled: "{{ puppet_service_enabled }}"
  when: puppet_service_manage
